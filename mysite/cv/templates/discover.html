<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Draw Platformer</title>

</head>

<body id="page-top">
                <table>
                    <tr>
                        <th>Title</th>
                        <th>High Score</th>
                        <th>Upvotes</th>
                        <th>Upvote Button</th>
                        <th>Downvote Button</th>
                        <th>Image</th>
                    </tr>
                {% for map in recent_maps %}
                    <tr>
                        <td>{{map.title}}</td>
                        <td>{{map.high_score}}</td>
                        <td>{{map.votes}}</td>
                        <td><button onclick="vote('{{map.title}}', true)">Upvote</button></td>
                        <td><button onclick="vote('{{map.title}}', false)">Downvote</button></td>
                        <td><img src="{{ map.input_img.url }}" height="200" width="250"></td>
                    </tr>
                {% endfor %}
                </table>
</body>

    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.4/js.cookie.min.js"></script>

    <script>
        function vote(map_name, is_up_vote) {
            var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();

            function csrfSafeMethod(method) {
                return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
            }
            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                        xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                }
            });

            if (Cookies.get(map_name)) {
                alert('Already Voted On This Map!');
            }
            else {
                $.post("/game/" + map_name + "/upvote/", {
                    is_up_vote: is_up_vote
                },
                function(data, status) {
                });
                Cookies.set(map_name, 'true', {path: '' });
            }
        }
    </script>
    {% csrf_token %}
</html>
